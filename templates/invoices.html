{% extends "layout/layout.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="card content">
    <div class="card-header">
        <div class="row">
            <div class="col">
                <h5 class="card-title">
                    Invoice Record
                </h5>
                <h6 class="card-subtitle">
                    Invoice list
                </h6>
            </div>
            <div class="col">
                <div class="btnmodal">
                    <button type="button" class="btn btn-warning float-end" data-bs-toggle="modal"
                        data-bs-target="#addInvoiceModal"><i class="fa-solid fa-plus"></i>Add Invoice</button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
        <table id="myTable" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Customer Name</th>
                    <th>Invoice Date</th>
                    <th>Invoice Created Date</th>
                    <th>Invoice Amount</th>
                    <th>Invoice Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ invoice.custName }}</td>
                    <td>{{ invoice.invDate.strftime('%d-%m-%Y') }}</td>
                    <td>{{ invoice.created_at.strftime('%d-%m-%Y') }}</td>
                    <td>{{ invoice.invTotal }}</td>
                    <td>
                        {% if invoice.invStatus == 'Paid' %}
                        <span class="badge bg-success">Success</span>
                        {% else %}
                        <span class="badge bg-danger">{{ invoice.invStatus }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#updateInvoiceModal"><i
                                class="fa-solid fa-pen text-secondary"></i></a>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#deleteInvoiceModal"><i
                                class="fa-solid fa-trash text-danger"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<!-- Add Invoice Modal -->
<div class="modal fade" id="addInvoiceModal" tabindex="-1" aria-labelledby="addInvoiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <form action="{{ url_for('invoices') }}" method="post">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addInvoiceModalLabel">Add Invoice</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm">
                            <label for="customer"><strong>Customer:</strong></label>
                            <select name="custID" id="custID" class="form-control" required>
                                <option value="" disabled selected>Select customer name</option>
                                {% for customer in customers %}
                                <option value="{{customer.custID}}">{{customer.custName}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-sm">
                            <label for="invoice_date"><strong>Invoice Date:</strong></label>
                            <input type="date" name="invDate" id="invDate" class="form-control" required>
                        </div>
                        <div class="col-sm">
                            <label for="invoice_due"><strong>Invoice Due:</strong></label>
                            <input type="date" name="invDue" id="invDue" class="form-control" required>
                        </div>
                    </div>
                    <table class="table" id="dataTable">
                        <thead>
                            <tr>
                                <th class="col-grow">Service</th>
                                <th class="col-grow">Service Descriptions</th>
                                <th class="col-grow">Service Fee</th>
                                <th class="col-grow">Quantity</th>
                                <th class="col-shrink">Service Amount</th>
                                <th class="col-shrink">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <select id="serviceID[]" name="serviceID[]" class="form-control service-selector"
                                        required>
                                        <option value="" disabled selected>Select Service</option>
                                        {% for item in services %}
                                        <option value="{{ item['serviceID'] }}" data-fee="{{ item['serviceFee'] }}">
                                            {{ item['serviceName'] }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td><input class="form-control" type="text" name="itemDesc[]"
                                        placeholder="Service Descriptions" required></td>
                                <td><input class="form-control item-price" type="number" name="itemPrice[]"
                                        placeholder="Fee" required></td>
                                <td><input class="form-control item-qty" type="number" name="itemQty[]"
                                        placeholder="Qty" required></td>
                                <td><input class="form-control" type="number" name="itemAmt[]" placeholder="Amount"
                                        required>
                                </td>
                                <td><button type="button" class="btn btn-primary add-button">+</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="row">
                        <div class="col-sm"></div>
                        <div class="col-sm"></div>
                        <div class="col-sm"></div>
                        <div class="col-sm"></div>
                        <div class="col-sm">
                            <div class="input-group mb-3">
                                <span class="input-group-text">Subtotal</span>
                                <input type="number" class="form-control" placeholder="Subtotal" aria-label="Subtotal"
                                    name="invSubtotal" id="invSubtotal" readonly>
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text">Paid</span>
                                <input type="number" class="form-control" placeholder="Paid" aria-label="Paid"
                                    name="invPaid" id="invPaid" value="0.0" readonly>
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text">Due</span>
                                <input type="number" class="form-control" placeholder="Due" aria-label="Due"
                                    name="invTotal" id="invTotal" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-warning">Save changes</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}